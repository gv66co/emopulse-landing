<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURO-AURA: Emotion Drift System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000510; font-family: 'Segoe UI', sans-serif; color: #4fc3f7; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #ui-overlay { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; text-transform: uppercase; letter-spacing: 2px; }
        #video-container { position: absolute; bottom: 20px; right: 20px; width: 200px; border: 2px solid #1a237e; border-radius: 10px; overflow: hidden; opacity: 0.7; }
        video { width: 100%; transform: scaleX(-1); }
        .stat-box { background: rgba(0, 5, 16, 0.7); padding: 15px; border-left: 3px solid #00e5ff; margin-bottom: 10px; }
        .ai-assistant { position: absolute; bottom: 20px; left: 20px; max-width: 300px; font-size: 0.9em; line-height: 1.4; color: #81d4fa; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; align-items: center; justify-content: center; z-index: 100; font-size: 2em; }
    </style>
</head>
<body>

<div id="loading">INITIALIZING NEURO-LINK...</div>

<div id="ui-overlay">
    <div class="stat-box">
        <div>Subject: <span id="status">Scanning...</span></div>
        <div>Dominant Emotion: <span id="emotion">-</span></div>
        <div>Neural Pulse: <span id="pulse">0</span> BPM</div>
    </div>
</div>

<div class="ai-assistant" id="ai-text">
    Greetings. I am your Neural Assistant. I am monitoring your bio-rhythms and emotional aura drift.
</div>

<div id="video-container">
    <video id="video" autoplay muted></video>
</div>

<div id="canvas-container"></div>



<script>
/**
 * NEURO-AURA CORE SYSTEM
 * Integrating Emotion Recognition & 3D Generative Drift
 */

let scene, camera, renderer, auraMesh, particles;
let currentEmotion = "neutral";
let pulseRate = 72;

// Initialize Face API Models
async function setupAI() {
    const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/';
    await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
    await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
    document.getElementById('loading').style.display = 'none';
    startVideo();
}

function startVideo() {
    navigator.mediaDevices.getUserMedia({ video: {} }).then(stream => {
        const video = document.getElementById('video');
        video.srcObject = stream;
        detectEmotions(video);
    });
}

// Emotion & Pulse Logic
async function detectEmotions(video) {
    setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
        
        if (detections && detections.length > 0) {
            const expressions = detections[0].expressions;
            currentEmotion = Object.keys(expressions).reduce((a, b) => expressions[a] > expressions[b] ? a : b);
            
            document.getElementById('emotion').innerText = currentEmotion;
            document.getElementById('status').innerText = "CONNECTED";
            
            // Simulate Heart Rate variability based on emotion intensity
            pulseRate = 60 + Math.floor(expressions[currentEmotion] * 40);
            document.getElementById('pulse').innerText = pulseRate;
            
            updateAIResponse(currentEmotion);
        }
    }, 200);
}

function updateAIResponse(emotion) {
    const aiText = document.getElementById('ai-text');
    const responses = {
        happy: "I detect a surge in serotonin. Your aura is expanding with luminous vibrations.",
        sad: "Melancholy detected. Shifting neural rings to stabilize your emotional equilibrium.",
        angry: "High frequency detected. Cooling down the aura drift to prevent neural overload.",
        neutral: "Stable state confirmed. Deep space harmony maintained."
    };
    aiText.innerText = responses[emotion] || "Monitoring neural patterns...";
}

// 3D Visuals: The "Aura Drift"
function initThree() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // Create the Aura Sphere (The "Neuro Body")
    const geometry = new THREE.IcosahedronGeometry(2, 15);
    const material = new THREE.MeshPhongMaterial({
        color: 0x1a237e,
        wireframe: true,
        transparent: true,
        opacity: 0.6,
        emissive: 0x00e5ff,
        emissiveIntensity: 0.5
    });
    
    auraMesh = new THREE.Mesh(geometry, material);
    scene.add(auraMesh);

    // Space Particles (The Stars/Orbits)
    const partGeom = new THREE.BufferGeometry();
    const partCount = 5000;
    const posArray = new Float32Array(partCount * 3);
    for(let i=0; i < partCount * 3; i++) {
        posArray[i] = (Math.random() - 0.5) * 15;
    }
    partGeom.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
    const partMat = new THREE.PointsMaterial({ size: 0.005, color: 0xffffff });
    particles = new THREE.Points(partGeom, partMat);
    scene.add(particles);

    const light = new THREE.PointLight(0x00e5ff, 2, 100);
    light.position.set(5, 5, 5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x111111));

    camera.position.z = 5;
    animate();
}

function animate() {
    requestAnimationFrame(animate);

    // Aura reacts to emotions
    const time = Date.now() * 0.001;
    let speed = 0.01;
    let scale = 1.0;

    if (currentEmotion === 'happy') {
        speed = 0.05;
        auraMesh.material.color.setHex(0x00e5ff);
        scale = 1.2 + Math.sin(time * 5) * 0.1;
    } else if (currentEmotion === 'angry') {
        speed = 0.1;
        auraMesh.material.color.setHex(0xff5252);
    } else {
        auraMesh.material.color.setHex(0x1a237e);
    }

    auraMesh.rotation.y += speed;
    auraMesh.rotation.z += speed * 0.5;
    auraMesh.scale.set(scale, scale, scale);

    // Drift particles
    particles.rotation.y -= 0.001;

    renderer.render(scene, camera);
}

window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});

// Initialization
initThree();
setupAI();
</script>
</body>
</html>
