<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <title>EMOPULSE PRO - NEURAL COMPASS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --cyan: #3abff8; --bg: #010307; --glow: 0 0 25px rgba(58, 191, 248, 0.7); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', monospace; height: 100vh; overflow: hidden; }

        .terminal { display: flex; flex-direction: column; height: 100vh; padding: 20px; gap: 20px; background: radial-gradient(circle at center, #0a101f 0%, #000 100%); }

        /* GRID */
        .layout { display: grid; grid-template-columns: 1.4fr 0.6fr; grid-template-rows: 1fr 180px; gap: 20px; flex: 1; min-height: 0; }
        .panel { background: rgba(0, 5, 15, 0.8); border: 1px solid rgba(58, 191, 248, 0.3); border-radius: 20px; position: relative; overflow: hidden; box-shadow: inset 0 0 30px rgba(58, 191, 248, 0.1); }

        /* 3D COMPASS AREA */
        .area-vis { grid-column: 1; grid-row: 1; display: flex; align-items: center; justify-content: center; }
        #canvas3d { width: 100%; height: 100%; filter: drop-shadow(0 0 15px var(--cyan)); }

        /* CAMERA & DRIFT AURA */
        .area-cam { grid-column: 2; grid-row: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .cam-container { position: relative; width: 220px; height: 220px; margin-bottom: 20px; }
        .video-ring { width: 100%; height: 100%; border-radius: 50%; border: 2px solid var(--cyan); overflow: hidden; position: relative; z-index: 5; box-shadow: var(--glow); }
        #cam { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        /* GYVA DRIFT AURA APLINK KAMERĄ */
        .drift-aura { 
            position: absolute; top: -30px; left: -30px; right: -30px; bottom: -30px;
            border-radius: 50%; background: radial-gradient(circle, rgba(58, 191, 248, 0.3) 0%, transparent 70%);
            z-index: 1; transition: 0.5s; filter: blur(10px);
        }

        /* STATS */
        footer { grid-column: 1 / span 2; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .stat-card { background: rgba(58, 191, 248, 0.05); border-top: 2px solid var(--cyan); padding: 20px; text-align: center; }
        .stat-val { font-size: 2rem; font-weight: bold; color: var(--cyan); text-shadow: var(--glow); }
        .stat-label { font-size: 0.8rem; opacity: 0.6; text-transform: uppercase; margin-bottom: 5px; }

        button { width: 100%; padding: 15px; background: rgba(58, 191, 248, 0.1); border: 1px solid var(--cyan); color: var(--cyan); cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        button:hover { background: var(--cyan); color: black; box-shadow: var(--glow); }
    </style>
</head>
<body>

    <div class="terminal">
        <header style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 10px; border-bottom: 1px solid rgba(58, 191, 248, 0.2);">
            <div style="font-weight: bold; letter-spacing: 3px;">NEURAL_NAVIGATOR <span style="color:var(--cyan)">V3.0</span></div>
            <div id="clock" style="font-family: monospace; font-size: 1.2rem;">00:00:00</div>
        </header>

        <main class="layout">
            <section class="panel area-vis">
                <div id="visual-container" style="width:100%; height:100%;"></div>
            </section>

            <section class="panel area-cam">
                <div class="cam-container">
                    <div class="drift-aura" id="aura"></div>
                    <div class="video-ring">
                        <video id="cam" autoplay muted playsinline></video>
                    </div>
                </div>
                <div style="width: 100%; text-align: center;">
                    <div style="font-size: 0.7rem; color: #64748b; margin-bottom: 10px;">NEURAL DRIFT INTERFACE</div>
                    <button onclick="syncNeuralField()">SYNC NEURAL FIELD</button>
                </div>
            </section>

            <footer>
                <div class="stat-card"><div class="stat-label">Resonance</div><div class="stat-val" id="res-val">CALM</div></div>
                <div class="stat-card"><div class="stat-label">Frequency</div><div class="stat-val" id="freq-val">432 Hz</div></div>
                <div class="stat-card"><div class="stat-label">Stress Index</div><div class="stat-val" id="stress-val">0.12</div></div>
                <div class="stat-card"><div class="stat-label">Stability</div><div class="stat-val" id="stab-val">98%</div></div>
            </footer>
        </main>
    </div>

    <script>
        // --- 1. KAMERA IR AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        navigator.mediaDevices.getUserMedia({ video: true }).then(s => document.getElementById('cam').srcObject = s);
        
        function updateClock() { document.getElementById('clock').textContent = new Date().toLocaleTimeString('lt-LT'); }
        setInterval(updateClock, 1000);

        // --- 2. EMOCIJŲ REAKCIJA (SIMULIACIJA) ---
        let currentStress = 0.12;
        function syncNeuralField() {
            audioCtx.resume();
            setInterval(() => {
                currentStress = Math.random();
                const aura = document.getElementById('aura');
                const stressVal = document.getElementById('stress-val');
                
                stressVal.textContent = currentStress.toFixed(2);
                document.getElementById('freq-val').textContent = (400 + currentStress * 100).toFixed(0) + " Hz";
                
                // Reakcija: Aura keičia spalvą ir dydį
                if(currentStress > 0.6) {
                    aura.style.background = "radial-gradient(circle, rgba(255, 50, 50, 0.5) 0%, transparent 70%)";
                    aura.style.transform = "scale(1.3)";
                    document.getElementById('res-val').textContent = "HIGH";
                } else {
                    aura.style.background = "radial-gradient(circle, rgba(58, 191, 248, 0.4) 0%, transparent 70%)";
                    aura.style.transform = "scale(1)";
                    document.getElementById('res-val').textContent = "CALM";
                }
            }, 3000);
        }

        // --- 3. 3D KOSMINIS KOMPASAS (Three.js) ---
        const container = document.getElementById('visual-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        // Kompasas susideda iš kelių žiedų
        const compassGroup = new THREE.Group();
        scene.add(compassGroup);

        const createRing = (radius, detail, opacity) => {
            const geo = new THREE.IcosahedronGeometry(radius, detail);
            const mat = new THREE.MeshBasicMaterial({ color: 0x3abff8, wireframe: true, transparent: true, opacity: opacity });
            return new THREE.Mesh(geo, mat);
        };

        const outerRing = createRing(2.5, 1, 0.2);
        const innerRing = createRing(1.8, 1, 0.4);
        const core = new THREE.Mesh(new THREE.OctahedronGeometry(0.5, 0), new THREE.MeshBasicMaterial({ color: 0x3abff8 }));
        
        compassGroup.add(outerRing);
        compassGroup.add(innerRing);
        compassGroup.add(core);

        camera.position.z = 6;

        function animate() {
            requestAnimationFrame(animate);
            
            // Kompasas sukasi pagal "emocijas"
            const speed = 0.005 + (currentStress * 0.05);
            outerRing.rotation.y += speed;
            innerRing.rotation.x -= speed * 1.5;
            core.rotation.z += speed * 2;
            
            // "Kvėpavimas"
            const scale = 1 + (Math.sin(Date.now() * 0.002) * 0.1) + (currentStress * 0.2);
            compassGroup.scale.set(scale, scale, scale);
            
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });
    </script>
</body>
</html>
