<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emopulse – Emotional Field</title>

  <!-- TVARKINGAS CSS IMPORTAS -->
  <link rel="stylesheet" href="/emopulse.css">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #0b1b3f 0%, #02030a 55%, #000000 100%);
      color: #f5f7ff;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 1200px;
      padding: 32px;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 32px;
    }

    .left, .right {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    h1 {
      font-size: 28px;
      font-weight: 650;
      letter-spacing: 0.02em;
    }

    .subtitle {
      font-size: 14px;
      color: #a9b4ff;
      margin-top: 6px;
    }

    .input-row {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }

    .input-row input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #28305a;
      background: rgba(4, 8, 24, 0.9);
      color: #f5f7ff;
      font-size: 13px;
      outline: none;
    }

    .input-row input::placeholder {
      color: #5f6aa5;
    }

    .input-row button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #4f7dff, #9b5bff);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      box-shadow: 0 0 18px rgba(111, 140, 255, 0.6);
    }

    .input-row button:active {
      transform: translateY(1px);
      box-shadow: 0 0 10px rgba(111, 140, 255, 0.4);
    }

    .compass-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 8px;
    }

    .compass-glow {
      position: absolute;
      width: 70%;
      height: 70%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(88, 140, 255, 0.4), transparent 60%);
      filter: blur(18px);
      opacity: 0.9;
      transform: translateY(18%);
    }
  </style>
</head>


    .compass-sphere {
      position: relative;
      width: 70%;
      height: 70%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #ffdd99 0%, #ff7b7b 18%, #ff4fa8 32%, #7b5bff 52%, #2b9dff 72%, #050b1f 100%);
      box-shadow:
        0 0 40px rgba(120, 180, 255, 0.7),
        0 0 80px rgba(120, 80, 255, 0.6);
      overflow: hidden;
      animation: spin 18s linear infinite;
    }

    .compass-inner {
      position: absolute;
      inset: 10%;
      border-radius: 50%;
      background: radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.35), transparent 55%);
      mix-blend-mode: screen;
      opacity: 0.9;
    }

    .compass-orbit {
      position: absolute;
      inset: -8%;
      border-radius: 50%;
      border: 1px solid rgba(120, 180, 255, 0.4);
      box-shadow: 0 0 18px rgba(120, 180, 255, 0.6);
      animation: orbit 12s linear infinite;
    }

    .compass-orbit:nth-child(2) {
      inset: -14%;
      border-color: rgba(255, 160, 120, 0.5);
      box-shadow: 0 0 18px rgba(255, 160, 120, 0.7);
      animation-duration: 20s;
      animation-direction: reverse;
    }

    .compass-label {
      position: absolute;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #f5f7ff;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
    }

    .label-ca {
      top: 18%;
      left: 20%;
    }

    .label-joy {
      top: 18%;
      right: 20%;
    }

    .label-stress {
      bottom: 16%;
      left: 50%;
      transform: translateX(-50%);
    }

    .compass-pulse {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.18), transparent 60%);
      mix-blend-mode: screen;
      animation: pulse 3.5s ease-in-out infinite;
      pointer-events: none;
    }

    .metrics-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 16px;
      margin-top: 8px;
    }

    .card {
      background: radial-gradient(circle at top, rgba(33, 52, 110, 0.7), rgba(5, 9, 26, 0.95));
      border-radius: 18px;
      padding: 14px 16px;
      border: 1px solid rgba(88, 120, 210, 0.5);
      box-shadow: 0 0 18px rgba(10, 18, 60, 0.9);
    }

    .card-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #7f8dff;
      margin-bottom: 8px;
    }

    .metric-label {
      font-size: 11px;
      color: #9aa4ff;
      margin-top: 4px;
    }

    .metric-value {
      font-size: 13px;
      font-weight: 600;
      margin-top: 2px;
    }

    .score-big {
      font-size: 20px;
      font-weight: 650;
      margin-top: 6px;
    }

    .hashtags {
      font-size: 11px;
      color: #9ad5ff;
      margin-top: 6px;
      line-height: 1.4;
    }

    .stress-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .sun-icon {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: radial-gradient(circle, #ffe27a, #ffb347);
      box-shadow: 0 0 12px rgba(255, 210, 120, 0.9);
    }

    .stress-text-main {
      font-size: 12px;
      color: #ffd98a;
    }

    .stress-text-sub {
      font-size: 11px;
      color: #f5f7ff;
    }

    .timeline-graph {
      margin-top: 10px;
      height: 60px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(80, 120, 255, 0.1), rgba(255, 120, 200, 0.18));
      position: relative;
      overflow: hidden;
    }

    .timeline-line {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, #4f7dff, #9b5bff, #ff7bb0);
      opacity: 0.7;
      clip-path: path("M0,40 Q20,20 40,30 T80,35 T120,25 T160,30 T200,20 T240,30 T280,25 T320,35 T360,30 T400,20");
      animation: moveLine 6s linear infinite;
    }

    .timeline-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255, 255, 255, 0.2), transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.5;
    }

    .right-top-card {
      background: radial-gradient(circle at top, rgba(33, 52, 110, 0.7), rgba(5, 9, 26, 0.95));
      border-radius: 18px;
      padding: 16px 18px;
      border: 1px solid rgba(88, 120, 210, 0.5);
      box-shadow: 0 0 18px rgba(10, 18, 60, 0.9);
    }

    .webcam-row {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    video {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(88, 120, 210, 0.5);
      background: #000;
    }

    .status {
      font-size: 11px;
      color: #9aa4ff;
    }

    .bars {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 8px;
    }

    .bar-label {
      font-size: 11px;
      color: #9aa4ff;
      margin-bottom: 4px;
    }

    .bar-track {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(30, 40, 90, 0.9);
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #4f7dff, #9b5bff);
      transition: width 0.4s ease-out;
    }

    .bar-fill.stress {
      background: linear-gradient(90deg, #ff7b7b, #ffb347);
    }

    .bar-fill.calm {
      background: linear-gradient(90deg, #4fe3b8, #7fd6ff);
    }

    .bar-fill.joy {
      background: linear-gradient(90deg, #ffe27a, #ff9f7b);
    }

    .mood-map {
      margin-top: 10px;
      font-size: 11px;
      color: #9aa4ff;
    }

    .mood-gradient {
      margin-top: 6px;
      height: 10px;
      border-radius: 999px;
      background: linear-gradient(90deg, #4fe3b8, #4f7dff, #9b5bff, #ff7bb0, #ff7b7b);
      position: relative;
      overflow: hidden;
    }

    .mood-indicator {
      position: absolute;
      top: -4px;
      width: 2px;
      height: 18px;
      border-radius: 999px;
      background: #ffffff;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.9);
      left: 50%;
      transform: translateX(-50%);
      transition: left 0.4s ease-out;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes orbit {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.08); }
    }

    @keyframes moveLine {
      from { transform: translateX(-20px); }
      to { transform: translateX(20px); }
    }

    @media (max-width: 900px) {
      .app {
        grid-template-columns: minmax(0, 1fr);
      }
    }
   </style>
</head>
<body>
  <div class="app">
    <div class="left">
      <div>
        <h1>Understand your emotional field in real time</h1>
        <p class="subtitle">
          Type anything you're feeling or thinking. Using your camera, Emopulse analyzes your emotional field in real time.
        </p>
        <div class="input-row">
          <input id="textInput" placeholder="Type anything you're feeling or thinking..." />
          <button id="analyzeBtn">Analyze my emotional field</button>
        </div>
      </div>

      <div class="compass-wrapper">
        <div class="compass-glow"></div>
        <div class="compass-sphere" id="compassSphere">
          <div class="compass-inner"></div>
          <div class="compass-orbit"></div>
          <div class="compass-orbit"></div>
          <div class="compass-pulse" id="compassPulse"></div>
          <div class="compass-label label-ca">Ca</div>
          <div class="compass-label label-joy">Joy</div>
          <div class="compass-label label-stress">Stress</div>
        </div>
      </div>

      <div class="metrics-row">
        <div class="card">
          <div class="card-title">Emotional Aura</div>
          <div class="metric-label">Stability</div>
          <div class="metric-value" id="stabilityValue">12° toward</div>
          <div class="metric-label">Intensity</div>
          <div class="metric-value" id="intensityValue">Low</div>
          <div class="metric-label" style="margin-top:8px;">Score</div>
          <div class="score-big" id="scoreValue">76/100</div>
        </div>

        <div class="card">
          <div class="card-title">Emotional Signature</div>
          <div class="metric-value" id="signatureText">Calm focused energy</div>
          <div class="hashtags" id="hashtagsText">
            #calm #focused #energy #Sunshine with tranquility
          </div>
          <div class="mood-map">
            Mood Map: Positive → Euphoric → Intense
            <div class="mood-gradient">
              <div class="mood-indicator" id="moodIndicator"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Stress Risk</div>
          <div class="stress-row">
            <div class="sun-icon"></div>
            <div>
              <div class="stress-text-main" id="stressLabel">Sunshine with tranquility</div>
              <div class="stress-text-sub" id="stressScoreText">Stress Risk: 0.21 low</div>
            </div>
          </div>
          <div class="metric-label" style="margin-top:10px;">Emopulse Score</div>
          <div class="score-big" id="emopulseScore">76/100</div>
        </div>
      </div>

      <div class="card" style="margin-top:8px;">
        <div class="card-title">Emotional Timeline</div>
        <div class="metric-label">Energy</div>
        <div class="metric-value" id="energyValue">0.66 rising</div>
        <div class="timeline-graph">
          <div class="timeline-line"></div>
          <div class="timeline-overlay"></div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="right-top-card">
        <div class="card-title">Emopulse Camera Scan</div>
        <p class="subtitle" style="margin-top:0;">
          Real-time emotion detection using your webcam. No data is stored; analysis happens in your browser.
        </p>
        <div class="webcam-row">
          <video id="video" autoplay muted playsinline></video>
          <div class="status" id="statusText">Initializing camera and models…</div>
          <div class="bars">
            <div>
              <div class="bar-label">Calm</div>
              <div class="bar-track">
                <div class="bar-fill calm" id="barCalm"></div>
              </div>
            </div>
            <div>
              <div class="bar-label">Joy</div>
              <div class="bar-track">
                <div class="bar-fill joy" id="barJoy"></div>
              </div>
            </div>
            <div>
              <div class="bar-label">Stress</div>
              <div class="bar-track">
                <div class="bar-fill stress" id="barStress"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">How it works</div>
        <p class="subtitle" style="margin-top:0;">
          Emopulse uses facial expression analysis to estimate emotional tendencies like calm, joy, and stress.
          These signals drive the compass colors, aura intensity, and mood map position.
        </p>
      </div>
    </div>
  </div>

    const video = document.getElementById("video");
    const statusText = document.getElementById("statusText");
    const barCalm = document.getElementById("barCalm");
    const barJoy = document.getElementById("barJoy");
    const barStress = document.getElementById("barStress");
    const moodIndicator = document.getElementById("moodIndicator");
    const compassSphere = document.getElementById("compassSphere");
    const compassPulse = document.getElementById("compassPulse");
    const stabilityValue = document.getElementById("stabilityValue");
    const intensityValue = document.getElementById("intensityValue");
    const scoreValue = document.getElementById("scoreValue");
    const signatureText = document.getElementById("signatureText");
    const hashtagsText = document.getElementById("hashtagsText");
    const stressLabel = document.getElementById("stressLabel");
    const stressScoreText = document.getElementById("stressScoreText");
    const emopulseScore = document.getElementById("emopulseScore");
    const energyValue = document.getElementById("energyValue");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const textInput = document.getElementById("textInput");

    let modelsLoaded = false;
    let analyzing = false;

    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        statusText.textContent = "Camera active. Loading emotion models…";
      } catch (err) {
        statusText.textContent = "Camera access denied or unavailable.";
        console.error(err);
      }
    }

    async function loadModels() {
      const MODEL_URL = "https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/weights";
      try {
        await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
        await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
        modelsLoaded = true;
        statusText.textContent = "Models loaded. Scanning emotions in real time.";
        startEmotionLoop();
      } catch (err) {
        statusText.textContent = "Failed to load emotion models.";
        console.error(err);
      }
    }

    function mapExpressionsToEmotions(expressions) {
      // face-api gives: neutral, happy, sad, angry, fearful, disgusted, surprised
      const happy = expressions.happy || 0;
      const neutral = expressions.neutral || 0;
      const sad = expressions.sad || 0;
      const angry = expressions.angry || 0;
      const fearful = expressions.fearful || 0;
      const disgusted = expressions.disgusted || 0;
      const surprised = expressions.surprised || 0;

      const joy = happy + 0.3 * surprised;
      const stress = angry + fearful + 0.5 * disgusted + 0.3 * sad;
      const calm = neutral + 0.2 * (1 - (joy + stress));

      const clamp = (v) => Math.max(0, Math.min(1, v));
      const total = joy + stress + calm || 1;
      return {
        joy: clamp(joy / total),
        stress: clamp(stress / total),
        calm: clamp(calm / total),
      };
    }

    function updateUIFromEmotions({ joy, stress, calm }) {
      const toPercent = (v) => (v * 100).toFixed(0) + "%";

      barCalm.style.width = toPercent(calm);
      barJoy.style.width = toPercent(joy);
      barStress.style.width = toPercent(stress);

      const moodPos = 10 + joy * 60 - stress * 20 + calm * 10;
      moodIndicator.style.left = `${Math.max(5, Math.min(95, moodPos))}%`;

      const intensity = Math.max(joy, stress);
      const score = Math.round((calm * 0.5 + joy * 0.4 - stress * 0.3 + 0.4) * 100);
      const energy = (0.3 + intensity * 0.7).toFixed(2);

      stabilityValue.textContent = `${Math.round((calm - stress) * 40)}° toward`;
      intensityValue.textContent = intensity < 0.3 ? "Low" : intensity < 0.6 ? "Medium" : "High";
      scoreValue.textContent = `${score}/100`;
      emopulseScore.textContent = `${score}/100`;
      energyValue.textContent = `${energy} rising`;

      let signature = "Calm focused energy";
      let tags = "#calm #focused #energy #Sunshine with tranquility";
      let stressLabelText = "Sunshine with tranquility";
      let stressRiskText = "Stress Risk: 0.21 low";

      if (stress > 0.55) {
        signature = "Tense elevated field";
        tags = "#stress #alert #overdrive #Storm in the distance";
        stressLabelText = "Storm signals detected";
        stressRiskText = `Stress Risk: ${(0.4 + stress * 0.6).toFixed(2)} elevated`;
      } else if (joy > 0.55) {
        signature = "Bright expansive energy";
        tags = "#joy #expansion #lightness #Sunrise in motion";
        stressLabelText = "Sunshine with sparkles";
        stressRiskText = `Stress Risk: ${(0.1 + stress * 0.3).toFixed(2)} low`;
      } else if (calm > 0.6) {
        signature = "Deep grounded calm";
        tags = "#calm #grounded #steady #Ocean with still waves";
        stressLabelText = "Sunshine with tranquility";
        stressRiskText = `Stress Risk: ${(0.05 + stress * 0.2).toFixed(2)} very low`;
      }

      signatureText.textContent = signature;
      hashtagsText.textContent = tags;
      stressLabel.textContent = stressLabelText;
      stressScoreText.textContent = stressRiskText;

      const hueBase = 220;
      const joyShift = joy * 80;
      const stressShift = stress * -60;
      const hue = hueBase + joyShift + stressShift;
      const sat = 70 + intensity * 20;
      const light = 40 + joy * 10 - stress * 5;

      compassSphere.style.background = `
        radial-gradient(circle at 30% 20%,
          hsl(${hue + 40}, ${sat}%, ${light + 20}%),
          hsl(${hue + 10}, ${sat + 10}%, ${light}%),
          hsl(${hue - 20}, ${sat + 5}%, ${light - 10}%),
          hsl(${hue - 40}, ${sat}%, ${light - 20}%),
          #050b1f 100%)
      `;

      const pulseScale = 1 + intensity * 0.12;
      const pulseOpacity = 0.2 + intensity * 0.5;
      compassPulse.style.opacity = pulseOpacity;
      compassPulse.style.transform = `scale(${pulseScale})`;
    }

    async function startEmotionLoop() {
      if (!modelsLoaded) return;
      analyzing = true;

      const options = new faceapi.TinyFaceDetectorOptions({ inputSize: 160, scoreThreshold: 0.5 });

      async function loop() {
        if (!analyzing) return;
        if (video.readyState === 4) {
          try {
            const result = await faceapi
              .detectSingleFace(video, options)
              .withFaceExpressions();

            if (result && result.expressions) {
              const mapped = mapExpressionsToEmotions(result.expressions);
              updateUIFromEmotions(mapped);
              statusText.textContent = "Emotions detected in real time.";
            } else {
              statusText.textContent = "No face detected. Look at the camera.";
            }
          } catch (err) {
            console.error(err);
            statusText.textContent = "Error analyzing emotions.";
          }
        }
        requestAnimationFrame(loop);
      }

      loop();
    }

    analyzeBtn.addEventListener("click", () => {
      const text = (textInput.value || "").toLowerCase();
      if (!text.trim()) return;

      let joy = 0.3, stress = 0.2, calm = 0.5;

      if (text.includes("happy") || text.includes("joy") || text.includes("excited")) {
        joy = 0.7; calm = 0.2; stress = 0.1;
      }
      if (text.includes("sad") || text.includes("tired") || text.includes("down")) {
        joy = 0.15; calm = 0.35; stress = 0.5;
      }
      if (text.includes("anxious") || text.includes("stress") || text.includes("angry")) {
        joy = 0.1; calm = 0.2; stress = 0.7;
      }
      if (text.includes("calm") || text.includes("peace") || text.includes("focused")) {
        joy = 0.25; calm = 0.65; stress = 0.1;
      }

      updateUIFromEmotions({ joy, stress, calm });
    });

    window.addEventListener("load", async () => {
      await initCamera();
      await loadModels();
    });
  </script>
</body>
</html>
