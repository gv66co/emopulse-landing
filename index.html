<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEURO-EVOLUTION: AURA DRIFT PRO</title>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <style>
        :root { --deep: #00020a; --neon: #00f2ff; --gold: #ffcc00; }
        body { margin: 0; background: var(--deep); color: var(--neon); font-family: 'Syncopate', sans-serif; overflow: hidden; }
        
        /* Sci-Fi HUD Interface */
        #hud-left { position: absolute; top: 40px; left: 40px; z-index: 100; border-left: 2px solid var(--neon); padding-left: 20px; text-transform: uppercase; }
        #hud-right { position: absolute; top: 40px; right: 40px; z-index: 100; text-align: right; border-right: 2px solid var(--neon); padding-right: 20px; }
        
        .metric { font-size: 0.7rem; color: rgba(0, 242, 255, 0.6); margin-bottom: 5px; }
        .value { font-size: 1.4rem; font-weight: 700; letter-spacing: 2px; }

        #video-feed { position: absolute; bottom: 30px; right: 30px; width: 180px; height: 180px; border-radius: 50%; border: 2px solid var(--neon); object-fit: cover; opacity: 0.4; filter: contrast(1.5) blue; z-index: 50; }
        
        canvas { display: block; filter: contrast(1.1) brightness(1.1); }

        #init-btn { position: fixed; inset: 0; background: var(--deep); z-index: 9999; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--neon); font-size: 1.5rem; letter-spacing: 10px; transition: 0.5s; }
        #init-btn:hover { background: #001a2e; text-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

<div id="init-btn">INITIALIZE NEURO-ORGANISM</div>

<div id="hud-left">
    <div class="metric">Neural Signature</div>
    <div id="emotion" class="value">SYNCHRONIZING...</div>
    <div class="metric" style="margin-top:20px;">Biological Rhythm</div>
    <div id="pulse" class="value">000 BPM</div>
</div>

<div id="hud-right">
    <div class="metric">System Stability</div>
    <div id="stability" class="value">99.9%</div>
    <div class="metric" style="margin-top:20px;">Aura Drift Phase</div>
    <div id="phase" class="value">STABLE</div>
</div>

<video id="video-feed" autoplay muted></video>

<script>
    let scene, camera, renderer, aura, rings = [], audioCtx, oscillator, lfo;
    let emotionData = { type: 'neutral', intensity: 0 };

    // --- AUDIO SYNTHESIZER (Neural Soundscape) ---
    function initNeuralAudio() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        oscillator = audioCtx.createOscillator();
        lfo = audioCtx.createOscillator();
        const filter = audioCtx.createBiquadFilter();
        const gainNode = audioCtx.createGain();

        oscillator.type = 'sawtooth';
        lfo.type = 'sine';
        lfo.frequency.value = 0.5;
        
        filter.type = 'lowpass';
        gainNode.gain.value = 0.1;

        const lfoGain = audioCtx.createGain();
        lfo.connect(lfoGain);
        lfoGain.connect(filter.frequency);
        
        oscillator.connect(filter);
        filter.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        
        oscillator.start();
        lfo.start();
    }

    function updateNeuralAudio(emotion, intensity) {
        if(!audioCtx) return;
        let freq = 110; // Base frequency (A2)
        if(emotion === 'happy') freq = 220;
        if(emotion === 'angry') freq = 55;
        
        oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.5);
        lfo.frequency.setTargetAtTime(intensity * 10, audioCtx.currentTime, 0.5);
    }

    // --- 3D EVOLVED GEOMETRY ---
    function init3D() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Core Aura (The Neuro-Body)
        const auraGeo = new THREE.SphereGeometry(1.5, 64, 64);
        const auraMat = new THREE.MeshStandardMaterial({
            color: 0x00f2ff,
            wireframe: true,
            emissive: 0x00f2ff,
            emissiveIntensity: 1,
            transparent: true,
            opacity: 0.8
        });
        aura = new THREE.Mesh(auraGeo, auraMat);
        scene.add(aura);

        // Neural Rings (Emotion History)
        for(let i=0; i<3; i++) {
            const rGeo = new THREE.TorusGeometry(2.5 + i*0.5, 0.01, 16, 100);
            const rMat = new THREE.MeshBasicMaterial({ color: 0x00f2ff, transparent: true, opacity: 0.3 });
            const ring = new THREE.Mesh(rGeo, rMat);
            ring.rotation.x = Math.PI / 2;
            rings.push(ring);
            scene.add(ring);
        }

        const pointLight = new THREE.PointLight(0x00f2ff, 2, 50);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        camera.position.z = 6;

        animate();
    }

    function animate() {
        requestAnimationFrame(animate);
        const time = Date.now() * 0.001;

        // Aura Drift Logic
        aura.rotation.y += 0.005 + (emotionData.intensity * 0.05);
        aura.rotation.z += 0.002;
        
        // Morph aura based on pulse
        const pulseScale = 1 + Math.sin(time * (1 + emotionData.intensity * 5)) * 0.05;
        aura.scale.set(pulseScale, pulseScale, pulseScale);

        // Rings rotation
        rings.forEach((ring, i) => {
            ring.rotation.z += 0.01 * (i + 1);
            ring.rotation.x += 0.005 * (emotionData.intensity);
        });

        renderer.render(scene, camera);
    }

    // --- AI ENGINE ---
    async function initAI() {
        const MODEL_URL = 'https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/';
        await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
        await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
        
        const video = document.getElementById('video-feed');
        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
        video.srcObject = stream;

        setInterval(async () => {
            const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
            if (detections.length > 0) {
                const expressions = detections[0].expressions;
                const dominant = Object.keys(expressions).reduce((a, b) => expressions[a] > expressions[b] ? a : b);
                
                emotionData.type = dominant;
                emotionData.intensity = expressions[dominant];

                updateUI();
                updateNeuralAudio(dominant, expressions[dominant]);
                
                // Real-time Aura color morphing
                if(dominant === 'happy') aura.material.color.setHex(0x00ffaa);
                else if(dominant === 'angry') aura.material.color.setHex(0xff3300);
                else if(dominant === 'sad') aura.material.color.setHex(0x0055ff);
                else aura.material.color.setHex(0x00f2ff);
            }
        }, 150);
    }

    function updateUI() {
        document.getElementById('emotion').innerText = emotionData.type;
        document.getElementById('pulse').innerText = Math.floor(68 + (emotionData.intensity * 40)) + " BPM";
        document.getElementById('phase').innerText = emotionData.intensity > 0.7 ? "UNSTABLE DRIFT" : "STABLE";
    }

    document.getElementById('init-btn').addEventListener('click', () => {
        document.getElementById('init-btn').style.opacity = '0';
        setTimeout(() => document.getElementById('init-btn').remove(), 500);
        initNeuralAudio();
        init3D();
        initAI();
    });
</script>
</body>
</html>
